{# ƒê∆∞·ª£c g·ªçi t·ª´ index.html v√† profile.html #}
{% for post in posts %}
<div class="card post" data-id="{{ post.id }}" id="post-{{post.id}}">
    <div class="post-header">
            <div class="avatar avatar-sm">
            {% if post.author.avatar %}
                <img src="{{ url_for('static', filename='uploads/avatars/' + post.author.avatar) }}" alt="Avatar c·ªßa {{ post.author.username }}">
            {% else %}
                {{ post.author.username[0]|upper }}
            {% endif %}
        </div>
            <div class="post-user-time">
            <strong><a href="{{ url_for('profile', username=post.author.username) }}">{{ post.author.username }}</a></strong>
            <span>{{ post.timestamp | format_datetime }}</span>
        </div>
    </div>

    {% if post.content %}
    <div class="post-content">{{ post.content }}</div>
    {% endif %}

    {% if post.media_url %}
    <div class="post-media">
        {% if post.media_type == 'image' %}
            <img src="{{ url_for('static', filename='uploads/posts_media/' + post.media_url) }}" alt="N·ªôi dung media">
        {% elif post.media_type == 'video' %}
            <video src="{{ url_for('static', filename='uploads/posts_media/' + post.media_url) }}" controls></video>
        {% endif %}
    </div>
    {% endif %}

    <div class="post-actions">
        <button onclick="likePostAPI({{ post.id }})">üëç Th√≠ch (<span id="likes-{{ post.id }}">{{ post.likes }}</span>)</button>
        <button onclick="toggleCommentForm({{ post.id }})">üí¨ B√¨nh lu·∫≠n</button>
    </div>
    <div class="comments-section" id="comments-section-{{ post.id }}">
            {% if post.comments %}
            {% for comment in post.comments|sort(attribute='timestamp') %}
            <div class="comment" id="comment-{{comment.id}}">
                <div class="post-header" style="margin-bottom: 0.3rem;">
                    <div class="avatar avatar-sm" style="width:30px; height:30px; font-size:0.8em; margin-right:0.5rem;">
                            {% if comment.commenter.avatar %}
                            <img src="{{ url_for('static', filename='uploads/avatars/' + comment.commenter.avatar) }}" alt="Avatar c·ªßa {{ comment.commenter.username }}">
                        {% else %}
                            {{ comment.commenter.username[0]|upper }}
                        {% endif %}
                    </div>
                    <div>
                        <strong><a href="{{ url_for('profile', username=comment.commenter.username) }}">{{ comment.commenter.username }}</a></strong>
                        <span class="comment-timestamp">{{ comment.timestamp | format_datetime }}</span>
                    </div>
                </div>
                {{ comment.text }} {# Gi·∫£ s·ª≠ comment text ƒë√£ an to√†n ho·∫∑c b·∫°n s·∫Ω escape n√≥ n·∫øu c·∫ßn #}
            </div>
            {% endfor %}
        {% else %}
            <p class="no-content" id="no-comments-{{post.id}}" style="font-size:0.85em; padding:5px 0;">Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.</p>
        {% endif %}
    </div>
    <div class="comment-form" id="comment-form-{{ post.id }}" style="display:none;">
        <input type="text" id="commentText-{{ post.id }}" placeholder="Vi·∫øt b√¨nh lu·∫≠n...">
        <button onclick="submitCommentAPI({{ post.id }})">G·ª≠i</button>
    </div>
</div>
{% endfor %}